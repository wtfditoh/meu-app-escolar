<!DOCTYPE html>
<html lang="pt-br">
<head>
    <script>
    if (!localStorage.getItem('dt_user_phone')) {
        window.location.href = 'login.html';
    }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hub Brain - Agenda</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="estilo.css?v=12.0">
    <link rel="stylesheet" href="agenda-estilo.css">
    <style>
        /* Topo Padrão Hub Brain */
        .glass-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            height: 70px;
            background: rgba(10, 10, 10, 0.8) !important;
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(138, 43, 226, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .hub-logo-container { display: flex; align-items: center; gap: 8px; }
        .hub-logo-text { font-weight: 900; font-size: 18px; letter-spacing: 1px; color: white; text-transform: uppercase; }
        .hub-logo-text.purple { color: #8a2be2; }
        .hub-symbol-mini { 
            background: rgba(138, 43, 226, 0.1); 
            padding: 5px; 
            border-radius: 8px; 
            border: 1px solid rgba(138, 43, 226, 0.3); 
            display: flex; 
        }

        .mes-indicador { 
            text-align: center; 
            padding: 20px 0 10px; 
            font-size: 12px; 
            font-weight: 800; 
            letter-spacing: 3px; 
            color: #666; 
            text-transform: uppercase; 
        }

        .fab-button { 
            background: #8a2be2 !important; 
            box-shadow: 0 4px 20px rgba(138, 43, 226, 0.4) !important; 
        }

        /* Estilo para o input quando houver erro */
        .input-erro {
            border: 1px solid #ff4444 !important;
            animation: shake 0.3s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="bg-dark">
    <header class="glass-header">
        <button onclick="window.location.href='index.html'" class="btn-icon">
            <i data-lucide="arrow-left"></i>
        </button>
        
        <div class="hub-logo-container">
            <span class="hub-logo-text">Hub</span>
            <div class="hub-symbol-mini">
                <i data-lucide="brain-circuit" style="color: #8a2be2; width: 18px; height: 18px;"></i>
            </div>
            <span class="hub-logo-text purple">Brain</span>
        </div>

        <div style="width: 38px;"></div>
    </header>

    <main class="container-agenda">
        <div class="mes-indicador" id="mes-topo">CARREGANDO...</div>

        <div class="calendar-card">
            <div class="calendar-nav">
                <button onclick="mudarMes(-1)" class="btn-nav-clean"><i data-lucide="chevron-left"></i></button>
                <div id="calendar-grid" class="calendar-grid"></div>
                <button onclick="mudarMes(1)" class="btn-nav-clean"><i data-lucide="chevron-right"></i></button>
            </div>
        </div>

        <div class="agenda-section">
            <h3 class="section-title" id="titulo-lista">Compromissos</h3>
            <div id="lista-agenda"></div> 
        </div>
    </main>

    <button class="fab-button" onclick="abrirModalAgendaHoje()">
        <i data-lucide="plus"></i>
    </button>

    <div id="modal-agenda" class="modal">
        <div class="modal-content glass">
            <h3 style="color: #8a2be2; margin-bottom: 20px;">Nova Atividade</h3>
            <input type="text" id="tarefa-nome" placeholder="Título" class="input-ia">
            <textarea id="tarefa-desc" placeholder="Detalhes" class="input-ia" style="height: 80px; resize: none;"></textarea>
            
            <select id="tarefa-materia" class="input-ia" style="background-color: #1a1a2e !important; color: white !important;">
                <option value="Geral">Geral / Outros</option>
            </select>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div>
                    <label style="font-size: 10px; color: #8a2be2;">INÍCIO</label>
                    <input type="date" id="tarefa-data-inicio" class="input-ia">
                </div>
                <div>
                    <label style="font-size: 10px; color: #ff4444;">PRAZO FINAL</label>
                    <input type="date" id="tarefa-data-fim" class="input-ia">
                </div>
            </div>
            
            <label class="btn-anexo" for="tarefa-img">
                <i data-lucide="image"></i> Anexar Foto
                <input type="file" id="tarefa-img" accept="image/*" style="display: none;" onchange="previewImg(this)">
            </label>
            <div id="preview-container"></div>

            <div class="area-botoes-modal">
                <button onclick="fecharModalAgenda()" class="btn-modal-voltar">Sair</button>
                <button id="btn-salvar-agenda" onclick="validarEAdicionar()" class="btn-modal-acao" type="button" style="background: #8a2be2; transition: 0.3s;">
                    Agendar
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="agenda-logica.js"></script>
    
    <script>
        // 1. VALIDAÇÃO INTELIGENTE (ADEUS AVISO DO CHROME)
        function validarEAdicionar() {
            const nomeInput = document.getElementById('tarefa-nome');
            const btn = document.getElementById('btn-salvar-agenda');
            const textoOriginal = "Agendar";

            if (!nomeInput.value.trim()) {
                // Efeito visual de erro
                btn.style.background = "#ff4444";
                btn.innerText = "Preencha o título!";
                nomeInput.classList.add('input-erro');

                // Volta ao normal após 2 segundos
                setTimeout(() => {
                    btn.style.background = "#8a2be2";
                    btn.innerText = textoOriginal;
                    nomeInput.classList.remove('input-erro');
                }, 2000);
                
                return; // Bloqueia o envio
            }

            // Se estiver ok, chama a função do arquivo externo
            if (typeof adicionarTarefa === "function") {
                adicionarTarefa();
            }
        }

        // 2. CORREÇÃO DE DATA (PARA MARCAR DIA 1 E NÃO DIA 2)
        function ajustarInterface() {
            const hojeBR = new Date().toLocaleDateString('pt-BR', {day: '2-digit'});
            
            setTimeout(() => {
                // Corrige o quadradinho no calendário
                const todosOsDias = document.querySelectorAll('.calendar-day, .day, div[data-day]');
                todosOsDias.forEach(quadrado => {
                    quadrado.classList.remove('today', 'active', 'current');
                    quadrado.style.border = "none";
                    quadrado.style.background = "none";
                    quadrado.style.color = "";

                    if (quadrado.innerText.trim().padStart(2, '0') === hojeBR) {
                        quadrado.style.border = "1px solid #8a2be2";
                        quadrado.style.background = "rgba(138, 43, 226, 0.2)";
                        quadrado.style.color = "#8a2be2";
                        quadrado.style.fontWeight = "bold";
                        quadrado.style.borderRadius = "8px";
                    }
                });

                // Atualiza o texto do mês no topo
                const dataFormatada = new Date().toLocaleDateString('pt-BR', {month: 'long', year: 'numeric'});
                const elementoMes = document.getElementById('mes-topo');
                if(elementoMes) elementoMes.innerText = dataFormatada.toUpperCase();
                
                lucide.createIcons();
            }, 400);
        }

        // Eventos de carregamento
        window.addEventListener('load', ajustarInterface);
        document.addEventListener('click', (e) => {
            if (e.target.closest('.btn-nav-clean')) {
                setTimeout(ajustarInterface, 200);
            }
        });
    </script>
</body>
</html>
